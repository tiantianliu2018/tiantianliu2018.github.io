

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="The Space to record knowledge and my life.">
  <meta name="author" content="Kelly Liu">
  <meta name="keywords" content="CS_learn, Keep Moving...">
  <title>HashMap æºç é˜…è¯» - Kelly&#39;s Blogs</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
    
  

  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Kelly</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-03-26 10:33" pubdate>
        2020å¹´3æœˆ26æ—¥ ä¸Šåˆ
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.5k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      46
       åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">HashMap æºç é˜…è¯»</h1>
            
            <div class="markdown-body" id="post-body">
              <h3 id="HashMap-æºç é˜…è¯»ç¬”è®°"><a href="#HashMap-æºç é˜…è¯»ç¬”è®°" class="headerlink" title="HashMap æºç é˜…è¯»ç¬”è®°"></a>HashMap æºç é˜…è¯»ç¬”è®°</h3><h4 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h4><p>java.util.HashMap<K,V>  æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸€ä¸ªé›†åˆç±»ï¼Œçœ‹çœ‹æºç å§ï¼</K,V></p>
<p>HashMap å…è®¸ key å’Œ value ä¸º nullï¼Œä¸ä¿è¯å…ƒç´ çš„é¡ºåºã€‚HashMap çš„ get å’Œ put å¯ä»¥å®ç°å¸¸æ•°çº§åˆ«çš„å¤æ‚åº¦ã€‚ HashMap çš„åˆå§‹å®¹é‡ capacity å’Œ è´Ÿè½½å› å­ load factor å¯¹å…¶æ€§èƒ½çš„å½±å“æ¯”è¾ƒå¤§ã€‚å½“ Entry çš„æ•°é‡è¶…è¿‡ capacity * load factor æ—¶ï¼Œå“ˆå¸Œè¡¨å°†ä¼šè¢« rehashï¼ˆå†…éƒ¨çš„æ•°æ®ç»“æ„é‡å»ºï¼‰</p>
<p>å¦å¤– HashMap éçº¿ç¨‹å®‰å…¨ï¼Œä¸è¿‡å¯ä»¥å€ŸåŠ© <code>Collections.synchroniedMap</code> è¿›è¡ŒåŒ…è£…ã€‚</p>
<pre><code class="hljs java">Map m = Collections.synchronizedMap(<span class="hljs-keyword">new</span> HashMap(...));</code></pre>
<a id="more"></a>
<h4 id="æºç é˜…è¯»"><a href="#æºç é˜…è¯»" class="headerlink" title="æºç é˜…è¯»"></a>æºç é˜…è¯»</h4><h4 id="ä¸€ã€é™æ€æˆå‘˜å˜é‡"><a href="#ä¸€ã€é™æ€æˆå‘˜å˜é‡" class="headerlink" title="ä¸€ã€é™æ€æˆå‘˜å˜é‡"></a>ä¸€ã€é™æ€æˆå‘˜å˜é‡</h4><pre><code class="hljs java"><span class="hljs-comment">/**
 * é»˜è®¤çš„åˆå§‹å®¹é‡ 16 - å¿…é¡»æ˜¯ 2 çš„å¹‚æ¬¡ 
 */</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">4</span>; <span class="hljs-comment">// aka 16</span>

<span class="hljs-comment">/**
 * æœ€å¤§å®¹é‡ - å¿…é¡»æ˜¯ 2 çš„å¹‚æ¬¡ 
 * MUST be a power of two &lt;= 1&lt;&lt;30.
 */</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MAXIMUM_CAPACITY = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>;

<span class="hljs-comment">/**
 * è´Ÿè½½å› å­ï¼Œå½“ Entry æ•°é‡è¾¾åˆ° å®¹é‡ * è´Ÿè½½å› å­ æ—¶ï¼Œ åˆ™æ‰©å……å½“å‰ HashMap çš„å®¹é‡ä¸ºå½“å‰çš„ 2 å€
 */</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="hljs-number">0.75f</span>;
<span class="hljs-comment">/**
 * å°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘çš„é˜ˆå€¼
 */</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> TREEIFY_THRESHOLD = <span class="hljs-number">8</span>;

<span class="hljs-comment">/**
 * çº¢é»‘æ ‘è½¬ä¸ºé“¾è¡¨çš„é˜ˆå€¼
 */</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> UNTREEIFY_THRESHOLD = <span class="hljs-number">6</span>;

<span class="hljs-comment">/**
 * HashMap å¯ä»¥è½¬ä¸ºçº¢é»‘æ ‘çš„æœ€å°å®¹é‡ï¼Œå¦‚æœè¾¾ä¸åˆ°è¯¥å€¼ï¼Œé¦–å…ˆä¼šé€‰æ‹©æ‰©å®¹
 */</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MIN_TREEIFY_CAPACITY = <span class="hljs-number">64</span>;</code></pre>
<h4 id="ç›¸å…³æ€è€ƒï¼š"><a href="#ç›¸å…³æ€è€ƒï¼š" class="headerlink" title="ç›¸å…³æ€è€ƒï¼š"></a>ç›¸å…³æ€è€ƒï¼š</h4><ol>
<li><p>å®¹é‡ä¸ºä»€ä¹ˆæ˜¯ 2 çš„å¹‚æ¬¡ï¼Ÿ</p>
<p>è¿™å°±è¦ä» hashMap å…ƒç´  put çš„æ—¶å€™è¯´èµ·äº†ï¼Œè¦æ‰¾åˆ°æ”¾å…¥æ–°å…ƒç´ çš„ä½ç½®ï¼Œæˆ‘ä»¬ä¸€èˆ¬æƒ³åˆ°çš„æ€è·¯æ˜¯å°† key çš„ hash å€¼å¯¹ hash table çš„é•¿åº¦ n å–ä½™ï¼Œä½†æ˜¯%è¿ç®—çš„æ•ˆç‡æ¯”è¾ƒä½ï¼Œäºæ˜¯åœ¨è¿™é‡Œå¼•å…¥ä½è¿ç®—ï¼Œé€šè¿‡ <code>hash &amp; (n-1)</code> æ¥è·å¾—æ–°å…ƒç´ çš„ç´¢å¼•ä½ç½®ï¼Œåªæœ‰å½“ n ä¸º 2 çš„æ¬¡å¹‚æ—¶ï¼Œæ‰æ»¡è¶³ä¸€ä¸ªå…¬å¼ï¼š<code>(n - 1) &amp; hash = hash % n</code>ã€‚ï¼ˆæ³¨æ„ï¼šè¿™é‡Œ hash å€¼ä¸æ˜¯ key çš„ hashCodeï¼Œåé¢ä¼šè§£é‡Šã€‚ï¼‰</p>
</li>
<li><p>è´Ÿè½½å› å­ä¸ºä»€ä¹ˆæ˜¯ 0.75ï¼Ÿ</p>
<p>Java API ä¸­è§£é‡Šï¼šå– 0.75 æ˜¯æ—¶é—´å’Œç©ºé—´æ•ˆç‡çš„ä¸€ä¸ªæƒè¡¡ã€‚è¾ƒé«˜çš„å€¼ä¼šé™ä½ç©ºé—´å¼€é”€ï¼Œä½†ä¼šå¢åŠ æŸ¥æ‰¾æˆæœ¬ã€‚</p>
<p><strong>æˆ‘çš„ç†è§£æ˜¯</strong>ï¼šå¦‚æœ load factor å–çš„æ¯”è¾ƒå°ï¼Œæ¯”å¦‚ 0.5, é‚£ä¹ˆè¾¾åˆ°å®¹é‡çš„ä¸€åŠå°±ä¼šè¿›è¡Œæ‰©å®¹ï¼Œè¿™æ ·ä¼šé¢‘ç¹è¿›è¡Œ resize æ“ä½œã€‚è€Œæ‰©å®¹æ—¶å˜æˆåŸæ¥å®¹é‡çš„ä¸¤å€ï¼Œè¿˜ä¼šä½¿å¾—ä½¿ç”¨ç©ºé—´å’Œæœªä½¿ç”¨ç©ºé—´çš„å·®å€¼é€æ¸å¢åŠ ï¼Œç©ºé—´åˆ©ç”¨ç‡ä½ä¸‹ã€‚  å‡å¦‚è¯´ load factor å–çš„æ¯”è¾ƒå¤§ï¼Œæ¯”å¦‚ 1ï¼Œé‚£ä¹ˆè¦ç­‰åˆ°æ‰€æœ‰ç©ºé—´éƒ½ç”¨å®Œäº†æ‰è¿›è¡Œæ‰©å®¹ï¼Œput æ—¶çš„æ—¶é—´æ•ˆç‡å°±ä¼šå¾ˆä½ã€‚å¯ä»¥è¯´ 0.75 æ˜¯ 0.5-1.0 çš„ä¸€ä¸ªä¸­é—´å€¼ã€‚</p>
<p><strong>ğŸŒ»æ¥è‡ª StackOverFlow çš„ä¸€ä¸ªæ•°å­¦è§£é‡Š</strong>ï¼š</p>
<p>ä¸€ä¸ª bucket ç©ºå’Œéç©ºçš„æ¦‚ç‡ä¸º 0.5ï¼Œé€šè¿‡ç‰›é¡¿äºŒé¡¹å¼ç­‰æ•°å­¦è®¡ç®—ï¼Œå¾—åˆ°è¿™ä¸ª load factor çš„å€¼ä¸ºlogï¼ˆ2ï¼‰ï¼Œçº¦ç­‰äº 0.693. å›ç­”è€…è¯´ï¼Œå¯èƒ½å°äº0.75 å¤§äºç­‰äºlogï¼ˆ2ï¼‰çš„factoréƒ½èƒ½æä¾›æ›´å¥½çš„æ€§èƒ½ï¼Œ0.75è¿™ä¸ªæ•°æ€ä¹ˆæ¥çš„ï¼Œå¤§æ¦‚æ˜¯æ–¹ä¾¿è®¡ç®—ï¼Ÿ</p>
</li>
<li><p>ä¸ºä»€ä¹ˆè¾¾åˆ° 8 è½¬çº¢é»‘æ ‘ï¼Ÿ</p>
<p>ä¹Ÿæ˜¯ä¸€ä¸ªæ•°å­¦ç»Ÿè®¡ï¼Œæ ¹æ®æ³Šæ¾åˆ†å¸ƒï¼Œåœ¨è´Ÿè½½å› å­0.75ï¼ˆHashMapé»˜è®¤ï¼‰çš„æƒ…å†µä¸‹ï¼Œå•ä¸ª hash æ§½å†…å…ƒç´ ä¸ªæ•°ä¸º 8 çš„æ¦‚ç‡å°äºç™¾ä¸‡åˆ†ä¹‹ä¸€ï¼›é“¾è¡¨è½¬çº¢é»‘æ ‘çš„å¼€é”€å’Œå†²çªå¸¦æ¥çš„é¢å¤–å¼€é”€çš„ä¸€ä¸ªæƒè¡¡ï¼›</p>
</li>
<li><p>ä¸ºä»€ä¹ˆåˆ° 6 æ‰è½¬é“¾è¡¨ï¼Ÿ</p>
<p>ä¸­é—´æœ‰ä¸ªå·®å€¼ 7 å¯ä»¥é˜²æ­¢é“¾è¡¨å’Œæ ‘ä¹‹é—´é¢‘ç¹çš„è½¬æ¢ã€‚å‡è®¾ä¸€ä¸‹ï¼Œå¦‚æœè®¾è®¡æˆé“¾è¡¨ä¸ªæ•°è¶…è¿‡8åˆ™é“¾è¡¨è½¬æ¢æˆæ ‘ç»“æ„ï¼Œé“¾è¡¨ä¸ªæ•°å°äº8åˆ™æ ‘ç»“æ„è½¬æ¢æˆé“¾è¡¨ï¼Œå¦‚æœä¸€ä¸ªHashMapä¸åœçš„æ’å…¥ã€åˆ é™¤å…ƒç´ ï¼Œé“¾è¡¨ä¸ªæ•°åœ¨8å·¦å³å¾˜å¾Šï¼Œå°±ä¼šé¢‘ç¹çš„å‘ç”Ÿæ ‘è½¬é“¾è¡¨ã€é“¾è¡¨è½¬æ ‘ï¼Œæ•ˆç‡ä¼šå¾ˆä½ã€‚</p>
</li>
</ol>
<hr>

<p>æºç ç»§ç»­æ¥çœ‹ğŸ˜</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hash</span><span class="hljs-params">(Object key)</span> </span>&#123;
    <span class="hljs-keyword">int</span> h;
    <span class="hljs-keyword">return</span> (key == <span class="hljs-keyword">null</span>) ? <span class="hljs-number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="hljs-number">16</span>);
&#125;</code></pre>
<p>æˆ‘ä»¬ä¸Šé¢æåˆ°ï¼Œè®¡ç®—å…ƒç´  key çš„ç´¢å¼•ä½ç½®æ—¶éœ€è¦ç”¨åˆ° hash å€¼ï¼Œå°±æ˜¯é€šè¿‡è¿™ä¸ªå‡½æ•°è®¡ç®—å¾—åˆ°çš„ï¼Œ<strong>key çš„ hashCode å³ç§» 16 ä½ï¼Œä¸è‡ªèº«åšå¼‚æˆ–è®¡ç®—</strong>ã€‚å®é™…ä¸Šå°±æ˜¯<strong>é«˜ä½ä½å¼‚æˆ–</strong>ã€‚</p>
<p>âœ¨<strong>è¿™æ ·åšæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</strong></p>
<p>HashMap çš„åˆå§‹å®¹é‡æ˜¯16ï¼Œè¦è¿œå°äº int ç±»å‹çš„èŒƒå›´ï¼Œæ‰€ä»¥å¦‚æœåªæ˜¯å•çº¯çš„ç”¨ hashCode å–ä½™æ¥è·å–å¯¹åº”çš„ bucket ä¼šå¤§å¤§å¢åŠ å“ˆå¸Œç¢°æ’çš„æ¦‚ç‡ï¼Œå¹¶ä¸”æœ€åæƒ…å†µä¸‹è¿˜ä¼šå°† HashMap å˜æˆä¸€ä¸ªå•é“¾è¡¨ã€‚ä¸»è¦æ˜¯å› ä¸ºå¦‚æœä½¿ç”¨ hashCode å–ä½™ï¼Œé‚£ä¹ˆç›¸å½“äº<strong>å‚ä¸è¿ç®—çš„åªæœ‰hashCodeçš„ä½ä½</strong>ï¼Œé«˜ä½æ˜¯æ²¡æœ‰èµ·åˆ°ä»»ä½•ä½œç”¨çš„ï¼Œæ‰€ä»¥ä¸ºäº†è®© hashCode é«˜ä½ä¹Ÿå‚ä¸è¿ç®—ï¼Œè¿›ä¸€æ­¥é™ä½ hash ç¢°æ’çš„æ¦‚ç‡ï¼Œä½¿å¾—æ•°æ®åˆ†å¸ƒæ›´å¹³å‡ï¼Œå°±é‡‡å–äº†è¿™æ ·çš„ä¼˜åŒ–ç­–ç•¥ã€‚</p>
<h4 id="äºŒã€æ„é€ æ–¹æ³•"><a href="#äºŒã€æ„é€ æ–¹æ³•" class="headerlink" title="äºŒã€æ„é€ æ–¹æ³•"></a>äºŒã€æ„é€ æ–¹æ³•</h4><p>HashMap åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œå¦‚æœä¸ä¼ å…¥åˆå§‹å®¹é‡ï¼Œä¼šé»˜è®¤å»ºç«‹ä¸€ä¸ª 16 çš„ hash tableï¼Œæ‰€ä»¥å½“éœ€è¦çš„ HashMap å­˜å‚¨çš„å…ƒç´ æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œå»ºè®®ä¼ å…¥å®¹é‡å¤§å°ï¼Œé¿å…é¢‘ç¹ resizeã€‚</p>
<p>å¦å¤–å½“ä½¿ç”¨é»˜è®¤æ„é€ æ–¹æ³•çš„æ—¶å€™ï¼Œåªæ˜¯å°† loadfactor è®¾ä¸ºäº† 0.75ï¼Œè¿™é‡Œçš„ threshload ä»ç„¶ä¸º 0</p>
<p>è€Œå½“ä½¿ç”¨åé¢ä¸¤ä¸ªæ„é€ æ–¹æ³•çš„æ—¶å€™ï¼Œåˆå§‹åŒ– loadfactor ä¸ºè®¾å®šå€¼ï¼Œå¦å¤–ä¼šå°† hash table çš„ threshold è®¾ä¸ºå¤§äºä¼ å…¥å®¹é‡å€¼çš„æœ€å°çš„ 2 çš„æ¬¡å¹‚ï¼ˆtableSizeFor æ–¹æ³•ï¼‰</p>
<pre><code class="hljs java"><span class="hljs-comment">// ç©ºå‚æ„é€ ï¼Œä½¿ç”¨åˆå§‹å®¹é‡ 16ï¼Œload factor 0.75</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class="hljs-comment">// all other fields defaulted</span>
&#125;

<span class="hljs-comment">// å¯ä»¥ä¼ å…¥è‡ªå®šä¹‰å®¹é‡çš„å¤§å°</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity)</span> </span>&#123;
    <span class="hljs-keyword">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);
&#125;

<span class="hljs-comment">// å¯ä»¥è®¾ç½®å®¹é‡å¤§å°å’Œ load factor</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity, <span class="hljs-keyword">float</span> loadFactor)</span> </span>&#123;
    <span class="hljs-keyword">if</span> (initialCapacity &lt; <span class="hljs-number">0</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">"Illegal initial capacity: "</span> +
                                           initialCapacity);
    <span class="hljs-keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)
        initialCapacity = MAXIMUM_CAPACITY;
    <span class="hljs-keyword">if</span> (loadFactor &lt;= <span class="hljs-number">0</span> || Float.isNaN(loadFactor))
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">"Illegal load factor: "</span> +
                                           loadFactor);
    <span class="hljs-keyword">this</span>.loadFactor = loadFactor;
    <span class="hljs-keyword">this</span>.threshold = tableSizeFor(initialCapacity);
&#125;

<span class="hljs-comment">// å°†å¦ä¸€ä¸ª Map ä¸­çš„å…ƒç´ æ‹·è´ä¸€ä»½åˆ°è‡ªå·±çš„å­˜å‚¨ç»“æ„ä¸­</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;
    <span class="hljs-keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR;
    putMapEntries(m, <span class="hljs-keyword">false</span>);
&#125;

<span class="hljs-comment">/**
 * è¿™ä¸ªå‡½æ•°åˆæ˜¯å¹²ä»€ä¹ˆçš„å‘¢ï¼Ÿ
 * å½“ç”¨æˆ·ä¼ å…¥çš„åˆå§‹å®¹é‡ä¸æ˜¯ 2 çš„å¹‚æ¬¡æ—¶ï¼Œè¿›è¡Œ threshold çš„è°ƒæ•´
 * æ‰¾åˆ°å¤§äºä¼ å…¥å®¹é‡å€¼çš„æœ€å°çš„é‚£ä¸ª 2 çš„å¹‚æ¬¡
 */</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">tableSizeFor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> cap)</span> </span>&#123;
    <span class="hljs-keyword">int</span> n = cap - <span class="hljs-number">1</span>;
    n |= n &gt;&gt;&gt; <span class="hljs-number">1</span>;
    n |= n &gt;&gt;&gt; <span class="hljs-number">2</span>;
    n |= n &gt;&gt;&gt; <span class="hljs-number">4</span>;
    n |= n &gt;&gt;&gt; <span class="hljs-number">8</span>;
    n |= n &gt;&gt;&gt; <span class="hljs-number">16</span>;
    <span class="hljs-keyword">return</span> (n &lt; <span class="hljs-number">0</span>) ? <span class="hljs-number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="hljs-number">1</span>;
&#125;</code></pre>
<h4 id="ä¸‰ã€æŸ¥æ‰¾"><a href="#ä¸‰ã€æŸ¥æ‰¾" class="headerlink" title="ä¸‰ã€æŸ¥æ‰¾"></a>ä¸‰ã€æŸ¥æ‰¾</h4><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> V <span class="hljs-title">get</span><span class="hljs-params">(Object key)</span> </span>&#123;
    Node&lt;K,V&gt; e;
    <span class="hljs-keyword">return</span> (e = getNode(hash(key), key)) == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : e.value;
&#125;

<span class="hljs-comment">/**
 * æŸ¥æ‰¾çš„æ—¶å€™å…ˆåˆ¤æ–­ hash å€¼ç›¸ç­‰ï¼ˆhashCodeï¼‰ç›¸ç­‰ï¼Œå†åˆ¤æ–­ equals ç›¸ç­‰ï¼Œæé«˜æ•ˆç‡
 */</span>
<span class="hljs-function"><span class="hljs-keyword">final</span> Node&lt;K,V&gt; <span class="hljs-title">getNode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> hash, Object key)</span> </span>&#123;
    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="hljs-keyword">int</span> n; K k;
  	<span class="hljs-comment">// å®šä½ key åœ¨ hash table ä¸­çš„ä½ç½®</span>
    <span class="hljs-keyword">if</span> ((tab = table) != <span class="hljs-keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="hljs-number">0</span> &amp;&amp;
        (first = tab[(n - <span class="hljs-number">1</span>) &amp; hash]) != <span class="hljs-keyword">null</span>) &#123;
        <span class="hljs-keyword">if</span> (first.hash == hash &amp;&amp; <span class="hljs-comment">// always check first node</span>
            ((k = first.key) == key || (key != <span class="hljs-keyword">null</span> &amp;&amp; key.equals(k))))
            <span class="hljs-keyword">return</span> first;
      	<span class="hljs-comment">// é“¾è¡¨æˆ–çº¢é»‘æ ‘ä¸­æŸ¥æ‰¾</span>
        <span class="hljs-keyword">if</span> ((e = first.next) != <span class="hljs-keyword">null</span>) &#123;
          	<span class="hljs-comment">// å¦‚æœè¯¥èŠ‚ç‚¹æ˜¯ TreeNode ç±»å‹ï¼Œè¦å»çº¢é»‘æ ‘ä¸­æŸ¥æ‰¾</span>
            <span class="hljs-keyword">if</span> (first <span class="hljs-keyword">instanceof</span> TreeNode)
                <span class="hljs-keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);
            <span class="hljs-comment">// æŸ¥æ‰¾é“¾è¡¨</span>
          	<span class="hljs-keyword">do</span> &#123;
                <span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;
                    ((k = e.key) == key || (key != <span class="hljs-keyword">null</span> &amp;&amp; key.equals(k))))
                    <span class="hljs-keyword">return</span> e;
            &#125; <span class="hljs-keyword">while</span> ((e = e.next) != <span class="hljs-keyword">null</span>);
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
&#125;</code></pre>
<h4 id="å››ã€æ’å…¥-Put"><a href="#å››ã€æ’å…¥-Put" class="headerlink" title="å››ã€æ’å…¥ Put"></a>å››ã€æ’å…¥ Put</h4><p>hash table çš„åˆå§‹åŒ–æ˜¯åœ¨ put ä¸­é€šè¿‡è°ƒç”¨ resize() å®Œæˆçš„</p>
<pre><code class="hljs JAVA"><span class="hljs-function"><span class="hljs-keyword">public</span> V <span class="hljs-title">put</span><span class="hljs-params">(K key, V value)</span> </span>&#123;
    <span class="hljs-keyword">return</span> putVal(hash(key), key, value, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>);
&#125;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@return</span> previous value, or null if none
 */</span>
<span class="hljs-function"><span class="hljs-keyword">final</span> V <span class="hljs-title">putVal</span><span class="hljs-params">(<span class="hljs-keyword">int</span> hash, K key, V value, <span class="hljs-keyword">boolean</span> onlyIfAbsent, <span class="hljs-keyword">boolean</span> evict)</span> </span>&#123;
    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="hljs-keyword">int</span> n, i;
  
  	<span class="hljs-comment">// è‹¥ hash table ä¸ºç©ºï¼Œé€šè¿‡ resize çš„æ–¹å¼å»ºç«‹ hash table</span>
    <span class="hljs-keyword">if</span> ((tab = table) == <span class="hljs-keyword">null</span> || (n = tab.length) == <span class="hljs-number">0</span>)
        n = (tab = resize()).length;
  
  	<span class="hljs-comment">// è®¡ç®—å½“å‰è¦æ’å…¥èŠ‚ç‚¹çš„ç´¢å¼•ä½ç½®ï¼Œå¦‚æœä½ç½®ç©ºï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹, æ”¾å…¥hash table</span>
  	<span class="hljs-comment">// æ­¤æ—¶ p = tab[index] å³ index ä½ç½®çš„å¤´ç»“ç‚¹</span>
    <span class="hljs-keyword">if</span> ((p = tab[i = (n - <span class="hljs-number">1</span>) &amp; hash]) == <span class="hljs-keyword">null</span>)
        tab[i] = newNode(hash, key, value, <span class="hljs-keyword">null</span>);
  
    <span class="hljs-keyword">else</span> &#123;  <span class="hljs-comment">// ç´¢å¼•ä½ç½®æœ‰å…ƒç´ äº†ï¼Œäº§ç”Ÿ hash å†²çª</span>
        Node&lt;K,V&gt; e; K k;
      
      	<span class="hljs-comment">// å¦‚æœæ’å…¥èŠ‚ç‚¹ key å€¼ä»¥åŠ hash å€¼ç­‰äºé“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªé”®å€¼å¯¹èŠ‚ç‚¹æ—¶ï¼Œåˆ™å°† e æŒ‡å‘è¯¥é”®å€¼å¯¹</span>
        <span class="hljs-keyword">if</span> (p.hash == hash &amp;&amp;
            ((k = p.key) == key || (key != <span class="hljs-keyword">null</span> &amp;&amp; key.equals(k))))
            e = p;
      
      	<span class="hljs-comment">// å¦‚æœ p æ˜¯ TreeNode ç±»å‹ï¼Œè°ƒç”¨çº¢é»‘æ ‘çš„æ’å…¥æ–¹æ³•</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (p <span class="hljs-keyword">instanceof</span> TreeNode)
            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="hljs-keyword">this</span>, tab, hash, key, value);
      
      	<span class="hljs-comment">// é“¾è¡¨æ’å…¥</span>
        <span class="hljs-keyword">else</span> &#123;          	
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> binCount = <span class="hljs-number">0</span>; ; ++binCount) &#123;
              	<span class="hljs-comment">// éå†é“¾è¡¨åˆ°è¾¾é“¾è¡¨å°¾, å³é“¾è¡¨ä¸­ä¸åŒ…å«è¯¥èŠ‚ç‚¹ï¼Œæ’å…¥èŠ‚ç‚¹</span>
                <span class="hljs-keyword">if</span> ((e = p.next) == <span class="hljs-keyword">null</span>) &#123;
                    p.next = newNode(hash, key, value, <span class="hljs-keyword">null</span>);
                  
                  	<span class="hljs-comment">// å½“é“¾è¡¨çš„é•¿åº¦å¤§äºç­‰äºé“¾è¡¨è½¬çº¢é»‘æ ‘çš„é˜ˆå€¼ï¼Œè°ƒæ•´ä¸ºçº¢é»‘æ ‘</span>
                    <span class="hljs-keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="hljs-number">1</span>) <span class="hljs-comment">// -1 for 1st</span>
                        treeifyBin(tab, hash);
                    <span class="hljs-keyword">break</span>;
                &#125;
              	<span class="hljs-comment">// é“¾è¡¨ä¸­åŒ…å«è¯¥èŠ‚ç‚¹ï¼Œåœæ­¢éå†</span>
                <span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;
                    ((k = e.key) == key || (key != <span class="hljs-keyword">null</span> &amp;&amp; key.equals(k))))
                    <span class="hljs-keyword">break</span>;
                p = e;
            &#125;
        &#125;
      
      	<span class="hljs-comment">// åˆ¤æ–­è¦æ’å…¥çš„é”®å€¼å¯¹æ˜¯å¦å­˜åœ¨ HashMap ä¸­</span>
        <span class="hljs-keyword">if</span> (e != <span class="hljs-keyword">null</span>) &#123; <span class="hljs-comment">// existing mapping for key</span>
            V oldValue = e.value;
          	<span class="hljs-comment">// onlyIfAbsent è¡¨ç¤ºæ˜¯å¦ä»…åœ¨ oldValue ä¸º null çš„æƒ…å†µä¸‹æ›´æ–°é”®å€¼å¯¹çš„å€¼</span>
            <span class="hljs-keyword">if</span> (!onlyIfAbsent || oldValue == <span class="hljs-keyword">null</span>)
                e.value = value;
            afterNodeAccess(e);
            <span class="hljs-keyword">return</span> oldValue;
        &#125;
    &#125;
    ++modCount;
  	<span class="hljs-comment">// hash table ä¸­çš„å…ƒç´ è¶…è¿‡é˜ˆå€¼ï¼Œæ‰©å®¹</span>
    <span class="hljs-keyword">if</span> (++size &gt; threshold)
        resize();
    afterNodeInsertion(evict);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
&#125;</code></pre>
<p>æ€»ç»“ï¼š</p>
<p>hashtable ä¸ºç©ºï¼Œè°ƒç”¨ resizeï¼Œåˆ›å»º hash table</p>
<p>è®¡ç®—å‡ºçš„ç´¢å¼•ä½ç½®æ²¡æœ‰å…ƒç´ ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹</p>
<p>å¦‚æœå‘ç”Ÿäº† hash å†²çªï¼š</p>
<p>key æ˜¯å¦å­˜åœ¨ï¼š</p>
<ul>
<li>è‹¥å­˜åœ¨ç›´æ¥ä¿®æ”¹æ—§å€¼ï¼Œè¿›è¡Œè¦†ç›–</li>
<li>ä¸å­˜åœ¨ï¼Œåˆ¤æ–­è¯¥èŠ‚ç‚¹æ˜¯é“¾è¡¨ä¸­çš„å…ƒç´ è¿˜æ˜¯çº¢é»‘æ ‘ï¼š<ul>
<li>é“¾è¡¨ï¼Œåˆ™æ’å…¥é“¾è¡¨å°¾éƒ¨ï¼Œå½“é“¾è¡¨çš„é•¿åº¦å¤§äºè°ƒæ•´é˜ˆå€¼æ—¶ï¼Œå°†é“¾è¡¨è½¬æˆçº¢é»‘æ ‘</li>
<li>çº¢é»‘æ ‘ï¼Œæ‰§è¡Œçº¢é»‘æ ‘çš„æ“ä½œ</li>
</ul>
</li>
</ul>
<p>è‹¥ hash table ä¸­çš„å…ƒç´ è¶…è¿‡é˜ˆå€¼ï¼Œè¿›è¡Œæ‰©å®¹ã€‚</p>
<p><img src="/2020/03/26/HashMap-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/hashmap.png" srcset="/img/loading.gif" alt="hashMap æ’å…¥å…ƒç´ æµç¨‹"> </p>
<p>ä¹‹å‰çœ‹è¿‡çš„ä¸€å¼ å›¾ï¼Œæ¯”è¾ƒæ¸…æ¥šï¼Œé“¾æ¥æ‰¾ä¸åˆ°äº†ï¼Œæœ›ä½œè€…åŸè°…ã€‚</p>
<h4 id="äº”ã€æ‰©å®¹"><a href="#äº”ã€æ‰©å®¹" class="headerlink" title="äº”ã€æ‰©å®¹"></a>äº”ã€æ‰©å®¹</h4><p>å½“ HashMap ä¸­çš„é”®å€¼å¯¹æ•°é‡è¶…è¿‡ <code>hash table å®¹é‡ * load factor</code>æ—¶ï¼Œè¿›è¡Œæ‰©å®¹ã€‚</p>
<p>HashMap æŒ‰å½“å‰å®¹é‡çš„ 2 å€è¿›è¡Œæ‰©å®¹ï¼Œé˜ˆå€¼ä¹Ÿå˜ä¸ºåŸæ¥çš„ 2 å€ï¼ˆå¦‚æœè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œé˜ˆå€¼æº¢å‡ºå½’é›¶ï¼Œåˆ™æŒ‰é˜ˆå€¼å…¬å¼é‡æ–°è®¡ç®—ï¼‰ã€‚æ‰©å®¹ä¹‹åï¼Œè¦é‡æ–°è®¡ç®—é”®å€¼å¯¹çš„ä½ç½®ï¼Œå¹¶æŠŠå®ƒä»¬ç§»åŠ¨åˆ°åˆé€‚çš„ä½ç½®ä¸Šå»ã€‚</p>
<pre><code class="hljs java"><span class="hljs-keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;
    Node&lt;K,V&gt;[] oldTab = table;
  	<span class="hljs-comment">// hash table çš„é•¿åº¦</span>
    <span class="hljs-keyword">int</span> oldCap = (oldTab == <span class="hljs-keyword">null</span>) ? <span class="hljs-number">0</span> : oldTab.length;
    <span class="hljs-keyword">int</span> oldThr = threshold;
    <span class="hljs-keyword">int</span> newCap, newThr = <span class="hljs-number">0</span>;
  
  	<span class="hljs-comment">// hash table å·²ç»åˆå§‹åŒ–è¿‡äº†</span>
    <span class="hljs-keyword">if</span> (oldCap &gt; <span class="hljs-number">0</span>) &#123;
      	<span class="hljs-comment">// å½“ table çš„å®¹é‡è¶…è¿‡æœ€å¤§å€¼ï¼Œä¸å†è¿›è¡Œæ‰©å®¹</span>
        <span class="hljs-keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;
            threshold = Integer.MAX_VALUE;
            <span class="hljs-keyword">return</span> oldTab;
        &#125;
      	<span class="hljs-comment">// æ–°çš„å®¹é‡ä¸ºæ—§å®¹é‡å·¦ç§»ä¸€ä½ï¼ˆ2å€ï¼‰ï¼Œå¹¶è®¾ç½®æ–°çš„é˜ˆå€¼ä¸ºåŸæ¥çš„ 2 å€</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="hljs-number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;
                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)
            newThr = oldThr &lt;&lt; <span class="hljs-number">1</span>; <span class="hljs-comment">// double threshold</span>
    &#125;
  
  	<span class="hljs-comment">// hash table æœªåˆå§‹åŒ–è¿‡å¹¶ä¸” hash table çš„é˜ˆå€¼å¤§äº0 (æ­¤æ—¶è°ƒç”¨çš„æ˜¯ä¼ å…¥åˆå§‹å®¹é‡çš„æ„é€ æ–¹æ³•)</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (oldThr &gt; <span class="hljs-number">0</span>) 
      	<span class="hljs-comment">// åœ¨æ„é€ å‡½æ•°é‡Œï¼Œhash table çš„åˆå§‹å®¹é‡æ˜¯ä¿å­˜åœ¨ threshold å½“ä¸­çš„</span>
      	<span class="hljs-comment">// å°† hash table çš„å®¹é‡è®¾ä¸ºæ„é€ å‡½æ•°ä¸­è®¾ç½®çš„åˆå§‹ threshold</span>
        newCap = oldThr;
  
  	<span class="hljs-comment">// hash table æœªè¢«åˆå§‹åŒ–ï¼Œå¹¶ä¸” hash table é˜ˆå€¼ä¸º0ï¼ˆé»˜è®¤æ„é€ å‡½æ•°ï¼‰</span>
    <span class="hljs-keyword">else</span> &#123;               
      	<span class="hljs-comment">// å®¹é‡è®¾å®šä¸ºé»˜è®¤å®¹é‡ 16</span>
        newCap = DEFAULT_INITIAL_CAPACITY;
      
      	<span class="hljs-comment">// æŒ‰ç…§å…¬å¼è®¡ç®— threshold = capacity * loadfactor</span>
        newThr = (<span class="hljs-keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);
    &#125;
  
  	<span class="hljs-comment">// æ ¹æ®é˜ˆå€¼è®¡ç®—å…¬å¼è®¡ç®—æ–°çš„é˜ˆå€¼ï¼Œè¿™é‡Œæ˜¯çœŸæ­£æ‰©å®¹æ—¶ä¿®æ”¹ newThreshold</span>
    <span class="hljs-keyword">if</span> (newThr == <span class="hljs-number">0</span>) &#123;
        <span class="hljs-keyword">float</span> ft = (<span class="hljs-keyword">float</span>)newCap * loadFactor;
        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="hljs-keyword">float</span>)MAXIMUM_CAPACITY ?
                  (<span class="hljs-keyword">int</span>)ft : Integer.MAX_VALUE);
    &#125;
  	<span class="hljs-comment">// å°†æ–°è®¡ç®—å¾—åˆ°çš„ threshold èµ‹ç»™å…¨å±€å˜é‡ threshold</span>
    threshold = newThr;
  
    <span class="hljs-meta">@SuppressWarnings</span>(&#123;<span class="hljs-string">"rawtypes"</span>,<span class="hljs-string">"unchecked"</span>&#125;)
  	<span class="hljs-comment">// ============== çœŸæ­£çš„æ‰©å®¹æ“ä½œå¼€å§‹äº†===============</span>
  	<span class="hljs-comment">// åˆ›å»ºæ–°çš„ hash table æ•°ç»„ï¼Œå¹¶å®Œæˆæ•°ç»„çš„åˆå§‹åŒ–</span>
    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="hljs-keyword">new</span> Node[newCap];
    table = newTab;
  	<span class="hljs-comment">// å¦‚æœæ—§çš„ hash table ä¸ä¸ºç©ºï¼Œåˆ™éå†ï¼Œå¹¶å°†é”®å€¼å¯¹æ˜ å°„åˆ°æ–°çš„ hash table ä¸­</span>
    <span class="hljs-keyword">if</span> (oldTab != <span class="hljs-keyword">null</span>) &#123;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; oldCap; ++j) &#123;
            Node&lt;K,V&gt; e;
            <span class="hljs-keyword">if</span> ((e = oldTab[j]) != <span class="hljs-keyword">null</span>) &#123;
                oldTab[j] = <span class="hljs-keyword">null</span>;
              	<span class="hljs-comment">// è¯¥ä½ç½®åªæœ‰ä¸€ä¸ªå¤´èŠ‚ç‚¹ï¼Œç›´æ¥è®¡ç®—åœ¨æ–°çš„ hash table ä¸­çš„ä½ç½®</span>
                <span class="hljs-keyword">if</span> (e.next == <span class="hljs-keyword">null</span>)
                    newTab[e.hash &amp; (newCap - <span class="hljs-number">1</span>)] = e;
              
              	<span class="hljs-comment">// è¯¥ä½ç½®çš„å¤´èŠ‚ç‚¹æ˜¯çº¢é»‘æ ‘ï¼Œè¦å¯¹çº¢é»‘æ ‘è¿›è¡Œæ‹†åˆ†</span>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> TreeNode)
                    ((TreeNode&lt;K,V&gt;)e).split(<span class="hljs-keyword">this</span>, newTab, j, oldCap);
              
              	<span class="hljs-comment">// è¯¥ä½ç½®çš„å¤´èŠ‚ç‚¹æ˜¯é“¾è¡¨ä¸­çš„èŠ‚ç‚¹</span>
                <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// preserve order</span>
                    Node&lt;K,V&gt; loHead = <span class="hljs-keyword">null</span>, loTail = <span class="hljs-keyword">null</span>;
                    Node&lt;K,V&gt; hiHead = <span class="hljs-keyword">null</span>, hiTail = <span class="hljs-keyword">null</span>;
                    Node&lt;K,V&gt; next;
                  	<span class="hljs-comment">// éå†é“¾è¡¨ï¼Œå¹¶å°†é“¾è¡¨èŠ‚ç‚¹æŒ‰åŸé¡ºåºè¿›è¡Œåˆ†ç»„</span>
                  	<span class="hljs-comment">// æ ¹æ® key çš„ hash å€¼ä¸åŸ hash table çš„å®¹é‡ä¸æ“ä½œçš„ç»“æœæ˜¯å¦ä¸º0åˆ†ä¸ºä¸¤ç»„</span>
                    <span class="hljs-keyword">do</span> &#123;
                        next = e.next;
                      	<span class="hljs-comment">// èŠ‚ç‚¹çš„ hash å€¼å’Œæ—§ hash table å®¹é‡åšä¸æ“ä½œï¼Œç»“æœæ˜¯0çš„ </span>
                        <span class="hljs-keyword">if</span> ((e.hash &amp; oldCap) == <span class="hljs-number">0</span>) &#123;
                            <span class="hljs-keyword">if</span> (loTail == <span class="hljs-keyword">null</span>)
                                loHead = e;
                            <span class="hljs-keyword">else</span>
                                loTail.next = e;
                            loTail = e;
                        &#125;
                        <span class="hljs-keyword">else</span> &#123;
                            <span class="hljs-keyword">if</span> (hiTail == <span class="hljs-keyword">null</span>)
                                hiHead = e;
                            <span class="hljs-keyword">else</span>
                                hiTail.next = e;
                            hiTail = e;
                        &#125;
                    &#125; <span class="hljs-keyword">while</span> ((e = next) != <span class="hljs-keyword">null</span>);
                  
                  	<span class="hljs-comment">// å°†åˆ†ç»„åçš„é“¾è¡¨æ˜ å°„åˆ°æ–° hash table ä¸­</span>
                    <span class="hljs-keyword">if</span> (loTail != <span class="hljs-keyword">null</span>) &#123;
                        loTail.next = <span class="hljs-keyword">null</span>;
                        newTab[j] = loHead;
                    &#125;
                    <span class="hljs-keyword">if</span> (hiTail != <span class="hljs-keyword">null</span>) &#123;
                        hiTail.next = <span class="hljs-keyword">null</span>;
                        newTab[j + oldCap] = hiHead;
                    &#125;
                &#125;
            &#125;
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> newTab;
&#125;</code></pre>
<p>æ€»ç»“ï¼š</p>
<p>è®¡ç®—æ–°çš„ hash table çš„å®¹é‡å’Œé˜ˆå€¼</p>
<p>åˆ›å»ºæ–°çš„ hash table å¹¶è¿›è¡Œåˆå§‹åŒ–ï¼Œå°†é”®å€¼å¯¹èŠ‚ç‚¹é‡æ–°æ˜ å°„åˆ°æ–°çš„ hash table é‡Œã€‚å¦‚æœèŠ‚ç‚¹æ˜¯ TreeNode ç±»å‹ï¼Œåˆ™éœ€è¦æ‹†åˆ†çº¢é»‘æ ‘ã€‚å¦‚æœæ˜¯æ™®é€šèŠ‚ç‚¹ï¼Œåˆ™èŠ‚ç‚¹æŒ‰åŸé¡ºåºè¿›è¡Œåˆ†ç»„ã€‚</p>
<p>Java 1.8 æ‰©å®¹çš„è¿‡ç¨‹è¦æ¯” 1.7 æ›´åŠ å¤æ‚ï¼Œæ˜¯ä¸ºäº†è§£å†³ 1.7 æ‰©å®¹æ—¶çš„å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œå› ä¸º HashMap éçº¿ç¨‹å®‰å…¨ï¼Œæ‰©å®¹åˆ†ç»„æŒ‡é’ˆçš„æŒ‡å‘è¿‡ç¨‹åœ¨çº¸ä¸Šç”»ä¸€ä¸‹å°±å¾ˆå®¹æ˜“æ˜ç™½äº†ã€‚</p>
<h4 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h4><p>æœ¬æ¥æ˜¯æƒ³äº†è§£ä¸€ä¸‹ HashMap çš„æ‰©å®¹æœºåˆ¶çš„ï¼Œé›¶é›¶æ•£æ•£å†™äº†è¿™ä¹ˆå¤šï¼Œå¯èƒ½æœ‰ä¸€äº›é”™è¯¯çš„åœ°æ–¹ã€‚</p>
<p>å¦å¤–å…³äºé“¾è¡¨å’Œçº¢é»‘æ ‘çš„è½¬æ¢ï¼Œæ‰©å®¹æ—¶çº¢é»‘æ ‘çš„æ‹†åˆ†è¿˜æ²¡æœ‰å¥½å¥½ç ”ç©¶ï¼Œä¸‹æ¬¡ä¸“é—¨æ€»ç»“ä¸€ä¸‹å§ã€‚</p>
<p>å†å²ä¸Šæœ€é•¿çš„ä¸€ç¯‡åšå®¢ï¼Œå“ˆå“ˆï¼Œè›®ä¸å®¹æ˜“çš„ï¼Œä½†é˜…è¯»æºç å¹¶åˆ†æçš„è¿‡ç¨‹ä¹Ÿæ˜¯ç‰¹åˆ«å¿«ä¹~~</p>
<p>é™„ä¸Šè®²è§£çš„æ¯”è¾ƒå¥½çš„å‡ ç¯‡åšå®¢ï¼š</p>
<p><a href="https://segmentfault.com/a/1190000012926722?utm_source=tag-newest#comment-area" target="_blank" rel="noopener"><a href="https://segmentfault.com/a/1190000012926722" target="_blank" rel="noopener">HashMap æºç è¯¦ç»†åˆ†æ(JDK1.8)</a></a></p>
<p><a href="https://blog.csdn.net/pange1991/article/details/82347284" target="_blank" rel="noopener">HashMapçš„æ‰©å®¹æœºåˆ¶â€”-resize()</a></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Java/">Java</a>
                    
                      <a class="hover-with-bg" href="/tags/Java-%E5%9F%BA%E7%A1%80/">Java åŸºç¡€</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/03/26/%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8-Flink-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">åä¸ºäº‘æœåŠ¡å™¨ Flink ç¯å¢ƒæ­å»º</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/03/24/Maven%20%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0/">
                        <span class="hidden-mobile">Maven å­¦ä¹ å°è®°</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>







  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "HashMap æºç é˜…è¯»&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>















</body>
</html>
